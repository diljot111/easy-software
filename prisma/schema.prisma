generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  EMPLOYEE
  EASY_TEAM
  CUSTOMER
}

// --------------------------------------
// ğŸ‘¤ USER TABLE
// --------------------------------------
model user {
  id              Int      @id @default(autoincrement())
  name            String
  email           String   @unique
  phone           String?
  password        String
  role            Role     @default(EMPLOYEE)
  
  // ğŸ”¹ Snake_case fields
  tenant_id       String?
  created_by_id   Int?
  created_at      DateTime @default(now())
  updated_at      DateTime @default(now()) @updatedAt

  // ğŸ”¹ Relations
  tenant          tenant?  @relation(fields: [tenant_id], references: [id])
  created_by      user?    @relation("UserCreator", fields: [created_by_id], references: [id])
  created_users   user[]   @relation("UserCreator")
  
  login_activities login_activity[]
}

// --------------------------------------
// ğŸ¢ TENANT TABLE
// --------------------------------------
model tenant {
  id               String   @id @default(cuid())
  
  // ğŸ”¹ Updated: Stores Website URL (mapped from 'business_name' input)
  business_name    String
  // ğŸ†• NEW FIELD: Stores 'Gym', 'Salon', etc.
  business_type    String?  
  business_phone   String?
  
  db_host          String
  db_user          String
  db_password      String
  db_name          String
  db_port          String?
  
  meta_token       String?  @db.Text
  waba_id          String?
  phone_number_id  String?

  created_at       DateTime @default(now())
  updated_at       DateTime @default(now()) @updatedAt

  // ğŸ”¹ Relations
  users            user[]
  automation_rules automation_rule[]
  automation_logs  automation_log[]
}

// --------------------------------------
// ğŸ¤– AUTOMATION RULE TABLE
// --------------------------------------
model automation_rule {
  id             String  @id @default(cuid())
  
  tenant_id      String
  event_type     String
  template_name  String
  delay_value    Int     @default(0)
  delay_unit     String  @default("Minutes")
  is_active      Boolean @default(true)

  created_at     DateTime @default(now())
  updated_at     DateTime @default(now()) @updatedAt
  
  // ğŸ”¹ Relations
  tenant         tenant  @relation(fields: [tenant_id], references: [id])
  logs           automation_log[]
}

// --------------------------------------
// ğŸ“œ AUTOMATION LOG TABLE
// --------------------------------------
model automation_log {
  id           String   @id @default(cuid())
  
  tenant_id    String
  rule_id      String
  external_id  String
  status       String
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now()) @updatedAt
  
  // ğŸ”¹ Relations
  tenant       tenant          @relation(fields: [tenant_id], references: [id])
  rule         automation_rule @relation(fields: [rule_id], references: [id])
}

// --------------------------------------
// ğŸ‘¥ CLIENT TABLE
// --------------------------------------
model client {
  id         Int      @id @default(autoincrement())
  name       String?  @db.VarChar(111)
  cont       String?  @db.VarChar(111)
  email      String?  @db.VarChar(111)
  active     Int?     @default(0)
  
  branch_id  Int      @default(1)
  doj        DateTime @default(now()) @db.Timestamp(0)
  updated_at DateTime @default(now()) @updatedAt
}

// --------------------------------------
// ğŸ” LOGIN ACTIVITY TABLE
// --------------------------------------
model login_activity {
  id         Int      @id @default(autoincrement())
  
  user_id    Int
  ip         String
  device     String
  date_time  DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt
  
  // ğŸ”¹ Relation
  user       user     @relation(fields: [user_id], references: [id])
}